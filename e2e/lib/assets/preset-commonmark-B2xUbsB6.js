import"./style-DeZY9Jm1.js";import{g as D,$ as N,s as P,e as O,P as z,a as E,p as A,T as F,D as M,b as B,c as I,d as L,E as W,r as $,n as J,f as K,t as H,h as R}from"./utils-CZPcvWg1.js";import{h as V}from"./index-BbeGQJHd.js";import{c as b}from"./call-command-V5fTwFSS.js";function _(t,e){const a=e.nodes[t];if(!a)throw D("node",t);return a}function p(t){if(!t)return!1;if(Array.isArray(t))return t.length>1?!1:p(t[0]);const e=t.content;return e?p(e):t.type==="text"}function j(t){if(t.content.childCount===1){const e=t.content.firstChild;if((e==null?void 0:e.type.name)==="text"&&e.marks.length===0)return e;if((e==null?void 0:e.type.name)==="paragraph"&&e.childCount===1){const a=e.firstChild;if((a==null?void 0:a.type.name)==="text"&&a.marks.length===0)return a}}return!1}const C=N(t=>{const e=t.get(P);t.update(O,r=>({...r,editable:r.editable??(()=>!0)}));const a=new z("MILKDOWN_CLIPBOARD");return new E({key:a,props:{handlePaste:(r,l)=>{var x,S;const u=t.get(A),s=(S=(x=r.props).editable)==null?void 0:S.call(x,r.state),{clipboardData:o}=l;if(!s||!o||r.state.selection.$from.node().type.spec.code)return!1;const c=o.getData("text/plain"),g=o.getData("vscode-editor-data");if(g){const n=JSON.parse(g),y=n==null?void 0:n.mode;if(c&&y){const{tr:i}=r.state,k=_("code_block",e);return i.replaceSelectionWith(k.create({language:y})).setSelection(F.near(i.doc.resolve(Math.max(0,i.selection.from-2)))).insertText(c.replace(/\r\n?/g,`
`)),r.dispatch(i),!0}}const m=o.getData("text/html");if(m.length===0&&c.length===0)return!1;const T=M.fromSchema(e);let d;if(m.length===0){const n=u(c);if(!n||typeof n=="string")return!1;d=B.fromSchema(e).serializeFragment(n.content)}else{const n=document.createElement("template");n.innerHTML=m,d=n.content.cloneNode(!0),n.remove()}const f=T.parseSlice(d),h=j(f);return h?(r.dispatch(r.state.tr.replaceSelectionWith(h,!0)),!0):(r.dispatch(r.state.tr.replaceSelection(f)),!0)},clipboardTextSerializer:r=>{const l=t.get(I);if(p(r.content.toJSON()))return r.content.textBetween(0,r.content.size,`

`);const s=e.topNodeType.createAndFill(void 0,r.content);return s?l(s):""}}})});C.meta={displayName:"Prose<clipboard>",package:"@milkdown/plugin-clipboard"};L(()=>{const t=W.make().enableInspector().config(e=>{e.set($,document.getElementById("app"))}).config(J).use(K).use(V).use(C).create();return t.then(e=>{globalThis.commands.toggleStrong=()=>{e.action(b(H.key))},globalThis.commands.toggleEmphasis=()=>{e.action(b(R.key))}}),t});
