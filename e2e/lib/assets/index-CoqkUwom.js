import{ad as R,ae as b,af as P,P as D,ag as W,ah as _,c as $,a as F,ai as z,aj as A}from"./utils-CZPcvWg1.js";var B="Expected a function",T=NaN,q="[object Symbol]",x=/^\s+|\s+$/g,G=/^[-+]0x[0-9a-f]+$/i,H=/^0b[01]+$/i,K=/^0o[0-7]+$/i,V=parseInt,X=typeof b=="object"&&b&&b.Object===Object&&b,J=typeof self=="object"&&self&&self.Object===Object&&self,Q=X||J||Function("return this")(),Y=Object.prototype,Z=Y.toString,ee=Math.max,te=Math.min,k=function(){return Q.Date.now()};function re(e,t,n){var u,i,d,f,r,a,o=0,l=!1,h=!1,g=!0;if(typeof e!="function")throw new TypeError(B);t=M(t)||0,w(n)&&(l=!!n.leading,h="maxWait"in n,d=h?ee(M(n.maxWait)||0,t):d,g="trailing"in n?!!n.trailing:g);function y(s){var c=u,p=i;return u=i=void 0,o=s,f=e.apply(p,c),f}function S(s){return o=s,r=setTimeout(m,t),l?y(s):f}function C(s){var c=s-a,p=s-o,v=t-c;return h?te(v,d-p):v}function E(s){var c=s-a,p=s-o;return a===void 0||c>=t||c<0||h&&p>=d}function m(){var s=k();if(E(s))return j(s);r=setTimeout(m,C(s))}function j(s){return r=void 0,g&&u?y(s):(u=i=void 0,f)}function U(){r!==void 0&&clearTimeout(r),o=0,u=a=i=r=void 0}function N(){return r===void 0?f:j(k())}function L(){var s=k(),c=E(s);if(u=arguments,i=this,a=s,c){if(r===void 0)return S(a);if(h)return r=setTimeout(m,t),y(a)}return r===void 0&&(r=setTimeout(m,t)),f}return L.cancel=U,L.flush=N,L}function w(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function ne(e){return!!e&&typeof e=="object"}function se(e){return typeof e=="symbol"||ne(e)&&Z.call(e)==q}function M(e){if(typeof e=="number")return e;if(se(e))return T;if(w(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=w(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(x,"");var n=H.test(e);return n||K.test(e)?V(e.slice(2),n?2:8):G.test(e)?T:+e}var ie=re;const ae=R(ie);class O{constructor(){this.beforeMountedListeners=[],this.mountedListeners=[],this.updatedListeners=[],this.markdownUpdatedListeners=[],this.blurListeners=[],this.focusListeners=[],this.destroyListeners=[],this.beforeMount=t=>(this.beforeMountedListeners.push(t),this),this.mounted=t=>(this.mountedListeners.push(t),this),this.updated=t=>(this.updatedListeners.push(t),this)}get listeners(){return{beforeMount:this.beforeMountedListeners,mounted:this.mountedListeners,updated:this.updatedListeners,markdownUpdated:this.markdownUpdatedListeners,blur:this.blurListeners,focus:this.focusListeners,destroy:this.destroyListeners}}markdownUpdated(t){return this.markdownUpdatedListeners.push(t),this}blur(t){return this.blurListeners.push(t),this}focus(t){return this.focusListeners.push(t),this}destroy(t){return this.destroyListeners.push(t),this}}const I=P(new O,"listener"),oe=new D("MILKDOWN_LISTENER"),ue=e=>(e.inject(I,new O),async()=>{await e.wait(W);const t=e.get(I),{listeners:n}=t;n.beforeMount.forEach(r=>r(e)),await e.wait(_);const u=e.get($);let i=null,d=null;const f=new F({key:oe,view:()=>({destroy:()=>{n.destroy.forEach(r=>r(e))}}),props:{handleDOMEvents:{focus:()=>(n.focus.forEach(r=>r(e)),!1),blur:()=>(n.blur.forEach(r=>r(e)),!1)}},state:{init:(r,a)=>{i=a.doc,d=u(a.doc)},apply:r=>!r.docChanged||r.getMeta("addToHistory")===!1?void 0:ae(()=>{const{doc:o}=r;if(n.updated.length>0&&i&&!i.eq(o)&&n.updated.forEach(l=>{l(e,o,i)}),n.markdownUpdated.length>0&&i&&!i.eq(o)){const l=u(o);n.markdownUpdated.forEach(h=>{h(e,l,d)}),d=l}i=o},200)()}});e.update(z,r=>r.concat(f)),await e.wait(A),n.mounted.forEach(r=>r(e))});ue.meta={package:"@milkdown/plugin-listener",displayName:"Listener"};export{ue as a,I as l};
