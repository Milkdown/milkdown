{"version":3,"file":"index.es.js","sources":["../src/useGetEditor.ts","../src/Editor.tsx","../src/useEditor.ts","../src/useInstance.ts"],"sourcesContent":["import { createContext, useContext, useEffect, useRef } from 'react'\n\nimport type { EditorInfoCtx } from './types'\n\nexport const editorInfoContext = createContext<EditorInfoCtx>({} as EditorInfoCtx)\n\nexport function useGetEditor() {\n  const { dom, editor: editorRef, setLoading, editorFactory: getEditor } = useContext(editorInfoContext)\n  const domRef = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    const div = domRef.current\n\n    if (!getEditor)\n      return\n\n    if (!div)\n      return\n\n    dom.current = div\n\n    const editor = getEditor(div)\n    if (!editor)\n      return\n\n    setLoading(true)\n    editor\n      .create()\n      .then((editor) => {\n        editorRef.current = editor\n      })\n      .finally(() => {\n        setLoading(false)\n      })\n      .catch(console.error)\n\n    return () => {\n      editorRef.current?.destroy()\n    }\n  }, [dom, editorRef, getEditor, setLoading])\n\n  return domRef\n}\n","import type { Editor } from '@milkdown/core'\nimport type { FC, ReactNode } from 'react'\nimport React, { useMemo, useRef, useState } from 'react'\n\nimport type { EditorInfoCtx, GetEditor } from './types'\nimport { editorInfoContext, useGetEditor } from './useGetEditor'\n\nexport const Milkdown: FC = () => {\n  const domRef = useGetEditor()\n\n  return <div data-milkdown-root ref={domRef} />\n}\n\nexport const MilkdownProvider: FC<{ children: ReactNode }> = ({ children }) => {\n  const dom = useRef<HTMLDivElement | undefined>(undefined)\n  const [editorFactory, setEditorFactory] = useState<GetEditor | undefined>(undefined)\n  const editor = useRef<Editor>()\n  const [loading, setLoading] = useState(true)\n\n  const editorInfoCtx = useMemo<EditorInfoCtx>(() => ({\n    loading,\n    dom,\n    editor,\n    setLoading,\n    editorFactory,\n    setEditorFactory,\n  }), [loading, editorFactory])\n\n  return (\n    <editorInfoContext.Provider value={editorInfoCtx}>\n      {children}\n    </editorInfoContext.Provider>\n  )\n}\n","import type { DependencyList } from 'react'\nimport { useCallback, useContext, useLayoutEffect } from 'react'\n\nimport type { GetEditor, UseEditorReturn } from './types'\nimport { editorInfoContext } from './useGetEditor'\n\nexport function useEditor(getEditor: GetEditor, deps: DependencyList = []): UseEditorReturn {\n  const editorInfo = useContext(editorInfoContext)\n\n  const factory = useCallback(getEditor, deps)\n\n  useLayoutEffect(() => {\n    editorInfo.setEditorFactory(() => factory)\n  }, [editorInfo, factory])\n\n  return {\n    loading: editorInfo.loading,\n    get: () => editorInfo.editor.current,\n  }\n}\n","import type { Editor } from '@milkdown/core'\nimport { useCallback, useContext } from 'react'\nimport { editorInfoContext } from './useGetEditor'\n\nexport type Instance = [true, () => undefined] | [false, () => Editor]\n\nexport function useInstance() {\n  const editorInfo = useContext(editorInfoContext)\n\n  const getInstance = useCallback(() => {\n    return editorInfo.editor.current\n  }, [editorInfo.editor])\n\n  return [editorInfo.loading, getInstance] as Instance\n}\n"],"names":["editorInfoContext","createContext","useGetEditor","dom","editorRef","setLoading","getEditor","useContext","domRef","useRef","useEffect","div","editor","_a","Milkdown","React","MilkdownProvider","children","editorFactory","setEditorFactory","useState","loading","editorInfoCtx","useMemo","useEditor","deps","editorInfo","factory","useCallback","useLayoutEffect","useInstance","getInstance"],"mappings":";AAIa,MAAAA,IAAoBC,EAA6B,EAAmB;AAE1E,SAASC,IAAe;AACvB,QAAA,EAAE,KAAAC,GAAK,QAAQC,GAAW,YAAAC,GAAY,eAAeC,EAAA,IAAcC,EAAWP,CAAiB,GAC/FQ,IAASC,EAAuB,IAAI;AAE1C,SAAAC,EAAU,MAAM;AACd,UAAMC,IAAMH,EAAO;AAKnB,QAHI,CAACF,KAGD,CAACK;AACH;AAEF,IAAAR,EAAI,UAAUQ;AAER,UAAAC,IAASN,EAAUK,CAAG;AAC5B,QAAKC;AAGL,aAAAP,EAAW,EAAI,GACfO,EACG,OAAO,EACP,KAAK,CAACA,MAAW;AAChB,QAAAR,EAAU,UAAUQ;AAAAA,MAAA,CACrB,EACA,QAAQ,MAAM;AACb,QAAAP,EAAW,EAAK;AAAA,MAAA,CACjB,EACA,MAAM,QAAQ,KAAK,GAEf,MAAM;;AACX,SAAAQ,IAAAT,EAAU,YAAV,QAAAS,EAAmB;AAAA,MACrB;AAAA,KACC,CAACV,GAAKC,GAAWE,GAAWD,CAAU,CAAC,GAEnCG;AACT;ACnCO,MAAMM,IAAe,MAAM;AAChC,QAAMN,IAASN,EAAa;AAE5B,SAAQ,gBAAAa,EAAA,cAAA,OAAA,EAAI,sBAAkB,IAAC,KAAKP,GAAQ;AAC9C,GAEaQ,IAAgD,CAAC,EAAE,UAAAC,QAAe;AACvE,QAAAd,IAAMM,EAAmC,MAAS,GAClD,CAACS,GAAeC,CAAgB,IAAIC,EAAgC,MAAS,GAC7ER,IAASH,EAAe,GACxB,CAACY,GAAShB,CAAU,IAAIe,EAAS,EAAI,GAErCE,IAAgBC,EAAuB,OAAO;AAAA,IAClD,SAAAF;AAAA,IACA,KAAAlB;AAAA,IACA,QAAAS;AAAA,IACA,YAAAP;AAAA,IACA,eAAAa;AAAA,IACA,kBAAAC;AAAA,EAAA,IACE,CAACE,GAASH,CAAa,CAAC;AAE5B,yCACGlB,EAAkB,UAAlB,EAA2B,OAAOsB,KAChCL,CACH;AAEJ;AC3BO,SAASO,EAAUlB,GAAsBmB,IAAuB,IAAqB;AACpF,QAAAC,IAAanB,EAAWP,CAAiB,GAEzC2B,IAAUC,EAAYtB,GAAWmB,CAAI;AAE3C,SAAAI,EAAgB,MAAM;AACT,IAAAH,EAAA,iBAAiB,MAAMC,CAAO;AAAA,EAAA,GACxC,CAACD,GAAYC,CAAO,CAAC,GAEjB;AAAA,IACL,SAASD,EAAW;AAAA,IACpB,KAAK,MAAMA,EAAW,OAAO;AAAA,EAC/B;AACF;ACbO,SAASI,IAAc;AACtB,QAAAJ,IAAanB,EAAWP,CAAiB,GAEzC+B,IAAcH,EAAY,MACvBF,EAAW,OAAO,SACxB,CAACA,EAAW,MAAM,CAAC;AAEf,SAAA,CAACA,EAAW,SAASK,CAAW;AACzC;"}